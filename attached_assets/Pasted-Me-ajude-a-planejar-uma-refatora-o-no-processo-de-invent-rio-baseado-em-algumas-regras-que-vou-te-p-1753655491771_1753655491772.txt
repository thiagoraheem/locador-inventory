Me ajude a planejar uma refatoração no processo de inventário baseado em algumas regras que vou te passar a seguir e mantendo o que for possível do que já existe para evitarmos retrabalho:
Na criação de um novo inventário, o usuário deve informar o tipo de inventário será realizado, informar a data de início do inventário e a data de previsão de término. Selecionar os locais de estoque que serão inventariados e as Categorias de Produtos que serão inventariados. Por padrão trazer todas as categorias selecionadas e criar opção de selecionar todas ou desmarcar todas.
O inventário será realizado em 3 contagens, sendo que as duas primeiras contagens são obrigatórias. Em cada contagem, deverão ser informados os usuários "Contadores" que farão as contagens. O inventário deve contar um status para informar que etapa se encontra (Aberto, 1a. contagem, 2a. contagem, 3a. contagem, Auditoria, Divergência, Fechado)
A estrutura dos itens do inventário devem armazenar todos os registros da tabela de estoque com o Produto, Local de Estoque e Quantidade, e na tabela ainda devem haver os campos para Contagem 1, Contagem 2, Contagem 3, Contagem 4 (coluna a ser utilizada em casos de auditoria), Quantidade Final, Diferença, Acuracidade.
O sistema deve registrar o usuário que realizou cada operação no sistema e a data e hora, desde a criação do inventário, abertura de contagem, fechamento de contagem, os registros de contagens, fechamento de inventário.
Devemos ter uma tela chamada "Mesa de Controle", que deverá conter um cabeçalho com 4 cards no estilo KPI contendo as informações Quantidade de Produtos, Quantidade de Categorias, Percentual inventariado, tempo decorrido entre a abertura do inventário e a hora atual ou hora do fechamento do inventário, caso já esteja preenchida.
Abaixo do cabeçalho, uma tabela com as colunas Produto, Local de Estoque, Quantidade Estoque, C1, C2, C3, C4, Quantidade Final, Diferença, Acuracidade)
No final da tabela as somas de cada coluna.

O sistema deverá fazer a contagem também dos produtos por número de série (controle de patrimônio), então deve congelar também esses registros da tabela stock_items com as mesmas características que informamos para os itens do estoque que vão ser congelados para o inventário, com as colunas de contagens e auditorias